<app-header></app-header>

<div class="container-fluid py-4">
  <div class="row justify-content-center">
    <div class="col-md-8">
      <div class="card">
        <div class="card-header">
          <h3 class="mb-0">My Profile</h3>
          <p class="text-muted mb-0">Manage your personal information</p>
        </div>
        
        <div class="card-body">
          <div class="alert alert-success" *ngIf="success">{{ success }}</div>
          <div class="alert alert-danger" *ngIf="error">{{ error }}</div>

          <!-- Profile Image Section -->
          <div class="text-center mb-4">
            <div class="profile-image-container">
              <img [src]="profileImage" alt="Profile Image" class="profile-image">
              <div class="image-overlay">
                <label for="profileImageInput" class="btn btn-sm btn-primary">
                  <i class="fas fa-camera"></i> Change Photo
                </label>
                <input 
                  type="file" 
                  id="profileImageInput" 
                  accept="image/*" 
                  (change)="onFileSelected($event)"
                  style="display: none;">
              </div>
            </div>
          </div>

          <form [formGroup]="profileForm" (ngSubmit)="onSubmit()">
            <div class="row">
              <div class="col-md-6 mb-3">
                <label for="first_name" class="form-label">First Name</label>
                <input 
                  type="text" 
                  class="form-control" 
                  id="first_name" 
                  formControlName="first_name"
                  [class.is-invalid]="profileForm.get('first_name')?.invalid && profileForm.get('first_name')?.touched">
              </div>
              <div class="col-md-6 mb-3">
                <label for="last_name" class="form-label">Last Name</label>
                <input 
                  type="text" 
                  class="form-control" 
                  id="last_name" 
                  formControlName="last_name"
                  [class.is-invalid]="profileForm.get('last_name')?.invalid && profileForm.get('last_name')?.touched">
              </div>
            </div>

            <div class="row">
              <div class="col-md-6 mb-3">
                <label for="email" class="form-label">Email</label>
                <input 
                  type="email" 
                  class="form-control" 
                  id="email" 
                  formControlName="email"
                  [class.is-invalid]="profileForm.get('email')?.invalid && profileForm.get('email')?.touched">
              </div>
              <div class="col-md-6 mb-3">
                <label for="phone_number" class="form-label">Phone Number</label>
                <input 
                  type="tel" 
                  class="form-control" 
                  id="phone_number" 
                  formControlName="phone_number"
                  [class.is-invalid]="profileForm.get('phone_number')?.invalid && profileForm.get('phone_number')?.touched">
              </div>
            </div>

            <div class="mb-3">
              <label for="address" class="form-label">Address</label>
              <textarea 
                class="form-control" 
                id="address" 
                rows="2"
                formControlName="address"></textarea>
            </div>

            <div class="row">
              <div class="col-md-6 mb-3">
                <label for="occupation" class="form-label">Occupation</label>
                <input 
                  type="text" 
                  class="form-control" 
                  id="occupation" 
                  formControlName="occupation">
              </div>
              <div class="col-md-6 mb-3">
                <label for="employer" class="form-label">Employer</label>
                <input 
                  type="text" 
                  class="form-control" 
                  id="employer" 
                  formControlName="employer">
              </div>
            </div>

            <div class="d-flex justify-content-between">
              <button type="button" class="btn btn-secondary" routerLink="/dashboard">Cancel</button>
              <button 
                type="submit" 
                class="btn btn-primary" 
                [disabled]="profileForm.invalid || loading">
                <span *ngIf="loading" class="spinner-border spinner-border-sm me-2"></span>
                {{ loading ? 'Updating...' : 'Update Profile' }}
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>